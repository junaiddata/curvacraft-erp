{% extends "base.html" %}
{% load humanize %}

{% block title %}Record Payment - Invoice #{{ invoice.invoice_number }}{% endblock %}

{% block content %}
<div class="form-page" style="max-width: 560px; margin: 0 auto;">
    <div class="page-header" style="flex-direction: column; align-items: flex-start; gap: 0.5rem;">
        <a href="{% url 'invoices:invoice_detail' pk=invoice.pk %}" class="text-muted" style="font-size: 0.875rem; text-decoration: none;">&larr; Back to Invoice</a>
        <h1 class="page-title">Record Payment</h1>
        <p class="page-subtitle text-muted">Invoice #{{ invoice.invoice_number }} â€” Amount due: AED {{ amount_due|floatformat:2|intcomma }}</p>
    </div>

    <div class="form-section" style="margin-bottom: var(--space-6); padding: var(--space-4); background: var(--color-primary-light); border-color: var(--color-accent);">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <span style="font-size: var(--text-sm); color: var(--color-text-secondary);">Amount due</span>
            <strong style="font-size: var(--text-xl); color: var(--color-primary);">AED {{ amount_due|floatformat:2|intcomma }}</strong>
        </div>
    </div>

    <form method="post" id="payment-form">
        {% csrf_token %}
        {% if form.non_field_errors %}
            <ul class="errorlist" style="margin-bottom: 1rem;">
                {% for error in form.non_field_errors %}
                    <li>{{ error }}</li>
                {% endfor %}
            </ul>
        {% endif %}

        <div class="form-section">
            <h3 class="form-section-title">Payment Details</h3>
            {{ form.as_p }}
            <datalist id="payment-methods">
                <option value="Bank Transfer"><option value="Cheque"><option value="Cash">
                <option value="Online Transfer"><option value="Card">
            </datalist>
        </div>

        <div class="form-actions">
            <a href="{% url 'invoices:invoice_detail' pk=invoice.pk %}" class="btn btn-secondary">Cancel</a>
            <button type="submit" class="btn">Save Payment</button>
        </div>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const amountInput = document.getElementById('id_amount');
    if (amountInput) {
        amountInput.addEventListener('blur', function() {
            var val = parseFloat(this.value);
            if (!isNaN(val) && val >= 0) this.value = val.toFixed(2);
        });
        amountInput.addEventListener('input', function() {
            var parts = this.value.split('.');
            if (parts.length > 1 && parts[1].length > 2)
                this.value = parts[0] + '.' + parts[1].substring(0, 2);
        });
    }
});
</script>
{% endblock %}
