<!-- templates/quotations/quotation_list.html -->
{% extends "base.html" %}
{% block content %}
<h1>Quotation Management Dashboard</h1>
<p>Manage Design and Fitout quotations for qualified enquiries.</p>
<hr>

{% for enquiry in enquiries %}
    <div style="border: 1px solid #ddd; padding: 15px; margin-bottom: 15px;">
        <h4>
            Project / Enquiry: {{ enquiry.customer.name }} - {{ enquiry.location }}
        </h4>
        <p>
            <small>Enquiry Status: {{ enquiry.get_status_display }} | 
            <a href="{% url 'enquiries:enquiry_detail' pk=enquiry.pk %}">View Enquiry Details</a></small>
        </p>

        <table style="width:100%; border-collapse: collapse;">
            <tr style="background-color: #f4f4f4;">
                <th style="padding: 8px; text-align: left;">Quotation Type</th>
                <th style="padding: 8px; text-align: left;">Status</th>
                <th style="padding: 8px; text-align: left;">Actions</th>
            </tr>
            
            <!-- DESIGN QUOTE ROW -->
            <tr>
                <td style="padding: 8px; border-top: 1px solid #ddd;"><strong>Design Quote</strong></td>
                <td style="padding: 8px; border-top: 1px solid #ddd;">
                    {% if enquiry.design_quote %}
                        {{ enquiry.design_quote.get_status_display }}
                    {% else %}
                        <span style="color: #888;">Not Created</span>
                    {% endif %}
                </td>
                <td style="padding: 8px; border-top: 1px solid #ddd;">
                    {% if enquiry.design_quote %}
                        <!-- If quote exists, show View and Manage buttons -->
                        <a href="{% url 'quotations:quotation_detail' pk=enquiry.design_quote.pk %}"><button>View Details</button></a>
                        <a href="{% url 'quotations:manage_quotation' enquiry_pk=enquiry.pk quote_type='DESIGN' %}"><button>Manage</button></a>
                    {% else %}
                        <!-- If quote does not exist, show only Create button -->
                        <a href="{% url 'quotations:manage_quotation' enquiry_pk=enquiry.pk quote_type='DESIGN' %}"><button>Create</button></a>
                    {% endif %}
                </td>
            </tr>

            <!-- FITOUT QUOTE ROW -->
            <tr>
                <td style="padding: 8px; border-top: 1px solid #ddd;"><strong>Fitout Quote</strong></td>
                <td style="padding: 8px; border-top: 1px solid #ddd;">
                    {% if enquiry.fitout_quote %}
                        {{ enquiry.fitout_quote.get_status_display }}
                    {% else %}
                        <span style="color: #888;">Not Created</span>
                    {% endif %}
                </td>
                <td style="padding: 8px; border-top: 1px solid #ddd;">
                     {% if enquiry.fitout_quote %}
                        <!-- If quote exists, show View and Manage buttons -->
                        <a href="{% url 'quotations:quotation_detail' pk=enquiry.fitout_quote.pk %}"><button>View Details</button></a>
                        <a href="{% url 'quotations:manage_quotation' enquiry_pk=enquiry.pk quote_type='FITOUT' %}"><button>Manage</button></a>
                    {% else %}
                        <!-- If quote does not exist, show only Create button -->
                        <a href="{% url 'quotations:manage_quotation' enquiry_pk=enquiry.pk quote_type='FITOUT' %}"><button>Create</button></a>
                    {% endif %}
                </td>
            </tr>
        </table>
    </div>
{% empty %}
    <p>No qualified enquiries found. Create an enquiry and qualify it to manage its quotations here.</p>
{% endfor %}

{% endblock %}